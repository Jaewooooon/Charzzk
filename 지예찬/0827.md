# TIL

## 240827

### 학습 내용
- 스프링부트 JPA

### 학습 내용 세부
- **값 타입 공유의 위험성과 해결책**
    - 자바 기본 타입이 아니라, 임베디드 같은 객체 타입은 공유했을 때 위험성이 있다!
    - ex. 회원 1과 2를 같은 city 가지고 있을 때 회원1의 city를 바꾸면 회원 2의 시티도 바뀜.
        
        ⇒ 결국 값을 복사해서 사용해야하는데, 누가 실수로 넣을 수 있다
        
        ⇒ 그래서 아예 값타입은 불변 객체로 설계해야한다!(String, Integer처럼!)
        
        - 생성자로만 값 설정하고 수정자(setter) 안 만들면 됨.
- **값 타입의 비교**
    - **‘==’ 비교**
        - 기본 값 타입은 그 안에 들어 있는 값이 같으면 같다고 나옴
        - 근데, 객체는 참조값을 비교하니까 그 안에 들어있는 값이 달라도 객체가 다르면 다르다고 나옴.
        
        ⇒ equals()를 써야함
        
    - **‘equals( )’ 비교**
        - 인스턴스의 값을 비교함.
        - 값 타입 비교에서는 이걸 써야함.
        
        ⇒ equals메서드를 @Override로 재정의해서 써야함
        
        ⇒ 웬만하면 자동으로 만들어주는 거 써야함(제너레이터에서 eq검색하면 나오는듯)
        
- **값 타입 컬렉션**
    - 값 타입을 컬렉션에 담아서 값 타입으로 사용하는 방식
    - 일대다 개념처럼 **별도의 테이블**을 만들고, 새로 PK 만들지 않고, 소속된 테이블을  FK로 어케어케…
    
    ⇒ 가급적 쓰지 않고 꼭 써야할 때(진짜 단순한 상황)만 쓴다….
    
    ⇒ Entity로 가급적 쓴다…

- **값 타입 컬렉션 사용**
    - 값 타입 하나 이상 저장할 때 사용
    - @ElementCollection, @CollectionTable 사용
    - 어차피 의존하는 거라, cascade와 orphanRemoval을 필수로 가짐
    - 조회에서 지연로딩 전략도 사용함.
- **동적 쿼리**
    - 쿼리 구조가 고정되어 있지 않고, 특정 조건에 따라 변화할 수 있는 쿼리.
- **JPQL**
    
    : 철저하게 잘해야함. 그다음 QueryDSL. 나머지 엄청 복잡한 5프로는 jdbctemplate쓰신다나.
    
    - JPA에서 쓰는 건데, 테이블이 아니라 객체를 대상으로 하는 쿼리 언어
        
        ⇒ 그래서 **특정 데이터베이스에 의존x**
        
        ⇒ 한 마디로 정의하면 객체지향 SQL
        
        → 이후 결국은 SQL로 변환됨
        
    - **한계**
        - 단순 문자열이라, 동적 쿼리를 만들기 어려움
        - ⇒ Mybatis나 QueryDsl!
- **QueryDSL**
    - 문자가 아닌 자바코드로 JPQL 작성 가능
        - 문법 오류가 바로 나타남. 컴파일 시점에도 오류 잡을 수 있고.
    - 동적 쿼리를 작성하기 편리함. 단순하고 쉬움! 실무 사용 권장!
    
    ⇒ JPQL만 잘하면 됨, QueryDSL은 쉽게 알 수 있음. 사이트 설명도 잘되어 잇고…
    
- **GROUP BY**
    - 데이터를 특정 칼럼 기준으로 그룹화시키는 명령어
- **HAVING**
    - GROUP BY 절에 조건을 걸고 싶을 때 사용하는 명령어
    - WHERE는 처음부터 테이블 자체에 조건을 건다면, HAVING은 그룹별로 묶인 칼럼에 조건을 걺
- **ORDER BY**
    - 데이터를 특정 칼럼값을 기준으로 정렬하기 위한 명령어
- **TypeQuery와 Query**
    - TypeQuery는 반환 타입이 명확할 때
    - Query 반환타입이 명확하지 않을 때
- **query.getResultList( )**
    - 결과가 하나 이상일 때, 리스트 반환
    - 결과가 없으면 빈 리스트 반환
- **query.getSingleResult( )**
    - 결과가 정확히 하나일 때, 단일 객체 반환
    - 결과가 없거나 둘 이상이면 예외 터짐.
- **파라미터 바인딩**
    - 함수나 쿼리에 작성되는 특정 속성을 어떤 매개변수로 매핑시켜놓는 것
- **프로젝션**
    - SELECT 절에 조회할 대상을 지정하는 것
    - 프로젝션 대상
        - 엔티티타입, 임베디드 타입, 스칼라 타입(숫자 문자 등 기본 데이터 타입) 다 가능.
    
